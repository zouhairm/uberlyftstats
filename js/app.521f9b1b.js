(function(e){function t(t){for(var n,r,o=t[0],c=t[1],l=t[2],d=0,p=[];d<o.length;d++)r=o[d],i[r]&&p.push(i[r][0]),i[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(p.length)p.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(n=!1)}n&&(s.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},i={app:0},s=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("64a9"),i=a.n(n);i.a},1:function(e,t){},2:function(e,t){},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("GraphPage",{attrs:{parsedRideData:e.fetchedData}}),e.showAbout?a("div",{staticClass:"about-box",attrs:{id:"about"}},[a("h2",[e._v("About Project")]),e._m(0),a("a",{staticClass:"close-about",attrs:{href:"#",title:"Close this message"},on:{click:function(t){t.preventDefault(),e.showAbout=!1}}},[e._v("Close")])]):e._e(),a("div",{staticClass:"footer"},[a("a",{staticClass:"about-link",on:{click:function(t){t.preventDefault(),e.showAbout=!e.showAbout}}},[e._v("About")]),e._m(1)]),a("div",{staticClass:"header"},[a("a",{staticClass:"login-link",on:{click:function(t){return t.preventDefault(),e.doLoginOrOut(t)}}},[e._v(e._s(e.loginText))]),a("span",{staticClass:"tooltiptext"},[e._v(e._s(e.loginHoverText))]),e.signedIn?a("a",{staticClass:"fetch-link",on:{click:function(t){return t.preventDefault(),e.doFetch(t)}}},[e._v("Fetch")]):e._e()])],1)},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"text-align":"left"}},[a("p",[e._v("\n        This project aims to visualize lyft/uber rides by crawling email receipts."),a("br"),e._v("\n\n        You can see a sample of what the data looks like from my account. If you would like to visualize your own data, click on the top right button to authenticate with Google and the app will fetch your data."),a("br")]),a("p",[e._v("\n          This app is made possible thanks to the following packages:\n          "),a("ul",[a("li",[a("a",{attrs:{target:"_blank",href:"https://github.com/vuejs/awesome-vue"}},[e._v("Vue.js")])]),a("li",[a("a",{attrs:{target:"_blank",href:"https://plot.ly/javascript"}},[e._v("Plotly.js")])]),a("li",[a("a",{attrs:{target:"_blank",href:"https://david-desmaisons.github.io/vue-plotly/"}},[e._v("Vue-Plotly")])])]),e._v("\n\n          For more technical details, check out this "),a("a",{attrs:{target:"_blank",href:"https://zouhairm.github.io/lyftuber"}},[e._v("Blog Post")])]),a("p",{staticClass:"privacy-note"},[e._v("\n        Note on Privacy and Data: The application relies on Google's OAuth2 workflow to access the emails, and therefore your login/password information is never shared with it either. Moreover, this application is "),a("em",[e._v("entirely")]),e._v(" client side. This means that your data is not sent to a 3rd party server nor is it saved anywhere.\n        ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",{staticClass:"copyText"},[e._v("\n        Made during late night hours by "),a("a",{attrs:{target:"_blank",href:"https://zouhairm.github.io/bio"}},[e._v("Zouhair M")])])}],r=(a("6762"),a("2fdb"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"graphs"},[a("div",{staticClass:"permile-graph"},[a("PlotlyVue",{attrs:{data:e.perMileData,layout:e.perMileLayout}})],1)])}),o=[],c=(a("ac6a"),a("456d"),a("75fc")),l=a("04d1"),u=a("030a"),d=a.n(u),p=a("148f"),f={name:"GraphPage",components:{PlotlyVue:l["Plotly"]},data:function(){return{perMileData:[],perMileLayout:{}}},mounted:function(){var e=document.querySelector(".permile-graph .js-plotly-plot");e.on("plotly_hover",function(t){var a=t.points[0].curveNumber;d.a.Fx.hover(e,[{curveNumber:a,pointNumber:t.points[0].pointNumber},{curveNumber:a+8,pointNumber:t.points[0].pointNumber},{curveNumber:a+16,pointNumber:t.points[0].pointNumber}],["xy","x2y2","x3y3"])})},created:function(){this.perMileLayout={titlefont:{size:16,color:"#ffffff",family:"Open Sans"},font:{color:"#fff"},legend:{orientation:"h",xanchor:"center",x:.5,y:1},hovermode:"closest",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",margin:{t:40,b:40,r:0,l:50,pad:1},dragmode:"select",clickmode:"event+select",yaxis:{domain:[.55,1],anchor:"x",title:"$/Mile",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}},yaxis2:{domain:[0,.45],anchor:"x2",title:"$",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}},yaxis3:{domain:[0,.45],anchor:"x3",title:"Miles",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}},xaxis:{domain:[0,1],anchor:"y",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}},xaxis2:{domain:[0,.45],anchor:"y2",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}},xaxis3:{domain:[.55,1],anchor:"y3",showticklabels:!0,ticks:"",tickfont:{color:"white"},titlefont:{color:"white"}}}},props:["parsedRideData"],watch:{parsedRideData:{deep:!0,immediate:!0,handler:function(e,t){var a,n;e&&null!=e.allRides&&e.allRides.length>0?(this.perMileData=h(e,"usd_per_mile",""),(a=this.perMileData).push.apply(a,Object(c["a"])(h(e,"total_usd","2"))),(n=this.perMileData).push.apply(n,Object(c["a"])(h(e,"distance_miles","3")))):this.perMileData=[]}}}};function h(e,t,a){var n=[],i=e.allRides,s=e.lumpedRides,r=[["Lyft","#ea0a8b"],["Uber","#000000"],["Uber+Lyft","#00ffff"]];return r.forEach(function(e){var r=e[0],o=e[1],c=i.filter(function(e){return e&&"taxi"in e&&e.taxi==r});if(c.length>0){var l={x:c.map(function(e){return e.date}),y:c.map(function(e){return e[t]}),xaxis:"x"+a,yaxis:"y"+a,legendgroup:r,showlegend:0==a,name:r,mode:"markers",marker:{color:o,opacity:.4}};"usd_per_mile"==t&&(l.hoverinfo="text",l.text=c.map(function(e){return e.usd_per_mile.toFixed(2)+" $/mile ($"+e.total_usd+" in "+e.distance_miles+" miles)"})),n.push(l)}if(s&&r in s){var u=Object.keys(s[r]).map(function(e){return parseInt(e)}),d=u.map(function(e){return Object.assign({},{month_time:e,mu:s[r][e][t+"_mu"],s:s[r][e][t+"_sigma"]})});d=p(d,"month_time");var f=d.map(function(e){return e.mu}),h=d.map(function(e){return e.s}),m=d.map(function(e){return new Date(e.month_time)}),g={x:m,y:f,visible:"Uber+Lyft"!=r||"legendonly",xaxis:"x"+a,yaxis:"y"+a,legendgroup:r+"_stats",showlegend:0==a,name:r+" Mean",mode:"lines",line:{shape:"spline",smoothing:.4,color:o+"88"}};"usd_per_mile"==t&&(g.hoverinfo="text",g.text=g.y.map(function(e){return"Average: "+e.toFixed(2)+" $/mile"})),n.push(g);var v=1.5,b=f.map(function(e,t){return e+v*this[t]},h),y=f.map(function(e,t){return Math.max(0,e-v*this[t])},h),_=b.concat(y.reverse()),w=m.concat(m.slice().reverse());g={x:w,y:_,visible:"Uber+Lyft"!=r||"legendonly",xaxis:"x"+a,yaxis:"y"+a,showlegend:!1,hoverinfo:"none",legendgroup:r+"_stats",fill:"toself",fillcolor:o+"55",name:r+"_err",mode:"lines",line:{shape:"spline",smoothing:.4,color:o+"55"}},n.push(g)}}),n}var m=f,g=(a("89b1"),a("2877")),v=Object(g["a"])(m,r,o,!1,null,"01a99176",null),b=v.exports,y=a("6b58"),_=a("f206"),w=!1,x='from: "Lyft Ride Receipt" OR from: "uber receipts" OR subject: "Uber Ride Receipt"',k=25,D=1e4,T=200,A=200;function O(e,t){var a={doneSearching:!1,doneParsing:!1,msgIdsQueue:new _,parsedData:new _,batchesAwaiting:0},n={userId:"me",maxResults:T,includeSpamTrash:!0,q:x};F(e,n,a),P(e,a),Object.assign(t,{allRides:[],lumpedRides:{}}),j(a,t)}function P(e,t){if(t.doneSearching&&t.msgIdsQueue.isEmpty())t.batchesAwaiting>0?setTimeout(function(){return P(e,t)},3*A):t.doneParsing=!0;else{var a=0,n=e.client.newBatch();while(!t.msgIdsQueue.isEmpty()&&a<k){var i=t.msgIdsQueue.dequeue(),s=e.client.gmail.users.messages.get({userId:"me",id:i,fields:"internalDate,payload(body, mimeType, parts)"});n.add(s,{id:"get "+i}),a++}a>0&&(t.batchesAwaiting+=1,n.then(function(e){return C(e,t)},function(e){console.error("REJECTED!",e),t.batchesAwaiting-=1})),setTimeout(function(){return P(e,t)},A)}}function C(e,t){for(var a in e.result)t.parsedData.enqueue(Object(y["b"])(e.result[a].result));t.batchesAwaiting-=1}function j(e,t){if(!e.doneParsing||!e.parsedData.isEmpty()){var a,n=[];while(!e.parsedData.isEmpty()&&n.length<k)n.push(e.parsedData.dequeue());if(n.length>0)(a=t.allRides).push.apply(a,n),Object(y["a"])(n,t.lumpedRides);setTimeout(function(){return j(e,t)},A)}}function F(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.client.gmail.users.messages.list(t);i.execute(function(i){if(i.messages.forEach(function(e){return a.msgIdsQueue.enqueue(e.id)}),n+=i.messages.length,i.nextPageToken&&n<D){var s=Object.assign({},t);s.pageToken=i.nextPageToken,F(e,s,a,n)}else a.doneSearching=!0})}w&&(D=25,T=25);var I={name:"app",data:function(){return{showAbout:!0,fetchedData:{allRides:[]},GoogleUser:null,signedIn:this.$isAuthenticated(),gapiClient:null}},created:function(){var e=this;this.signedIn&&this.$getGapiClient().then(function(t){e.gapiClient=t,O(t,e.fetchedData)})},components:{GraphPage:b},computed:{loginText:function(){return this.signedIn?"Logout":"Login"},loginHoverText:function(){return this.signedIn?"Click To Logout":"Click to Login using Google"}},methods:{doFetch:function(){this.gapiClient&&O(this.gapiClient,this.fetchedData)},doLoginOrOut:function(){var e=this;this.signedIn?(this.$logout(),this.signedIn=!1,this.fetchedData={allRides:[]},this.gapiClient=null):this.$login().then(function(){e.signedIn=e.$isAuthenticated(),e.$getGapiClient().then(function(t){e.gapiClient=t,O(t,e.fetchedData)})}).catch(function(e){console.error("Failed to login! ",e)})}}},M=I,N=(a("034f"),Object(g["a"])(M,i,s,!1,null,null,null)),R=N.exports,S=a("1685"),E=a.n(S);n["a"].config.productionTip=!1;var L="AIzaSyCSDjoV-gosaPDpCuvi0nNhIwFrnowvg6M",$="400078575357-0kmosifl221cur3p8g2lkes27qej3c2r.apps.googleusercontent.com";if(!L||!$)throw new Error("Has the .env.local file been setup? One or both variables are not set: VUE_APP_GAPI_API_KEY="+L+", VUE_APP_GAPI_CLIENT_ID="+$);var z={apiKey:L,clientId:$,scope:"email profile https://www.googleapis.com/auth/gmail.readonly",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"]};n["a"].use(E.a,z),window.Vue=new n["a"]({render:function(e){return e(R)}}).$mount("#app")},"64a9":function(e,t,a){},"6b58":function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return o}),a.d(t,"a",function(){return p});a("ac6a"),a("28a5"),a("6762"),a("2fdb"),a("7514"),a("a481");e.atob=a("eb21");var n=a("0ab9"),i=a("d556");function s(e){return atob(e.replace(/-/g,"+").replace(/_/g,"/"))}var r={taxi:"?",date:"?",date_email:"?",total:NaN,currency:"?",distance:NaN,distance_units:"?",time_minutes:NaN};function o(e){if(!e)return r;var t=e.payload,a=e.internalDate;if(!t)return r;if("body"in t&&t.body.size>0)return null==t.mimeType?(console.error("This does not have a mimeType!",t),r):c(s(t.body.data),t.mimeType,a);if("parts"in t&&"body"in t.parts[0]){var n=t.parts.find(function(e){return"text/html"==e.mimeType||"text/plain"==e.mimeType});if(n)return c(s(n.body.data),n.mimeType,a);console.warn("did not find any data in this email ??",t)}return r}function c(e,t,a){t.includes("html")&&(e=i.parse(e).structuredText);var n=null;return n=e.includes("Lyft")||e.includes("lyft")?u(e):d(e),l(n,a),n}function l(e,t){try{e.date_email=new Date(parseInt(t))}catch(i){console.error("failed to convert email date!",t,i)}"?"==e.date?e.date=e.date_email:e.date=new Date(Date.parse(e.date));var a=-1;switch(e.distance_units){case"mi":case"Mi":case"MI":case"miles":case"Miles":a=1;break;case"km":case"Km":case"KM":case"kilometers":case"Kilometers":case"kiloMeters":case"KiloMeters":a=.621371;break;default:console.warn("unkown distance unit "+e.distance_units)}var n=0;switch(e.currency=e.currency.replace(":","").trim(),e.currency){case"$":case"USD":case"US$":n=1;break;case"CA$":case"CAD":n=.77;break;case"NZ":case"Nz":case"NZ$":case"NZD":n=.68;break;case"£":case"Â£":case"GBP":n=1.25;break;case"A$":case"AUD":n=.71;break;case"EUR":case"â¬":n=1.13;break;case"Rs":n=.0057;break;default:console.warn("unkown currency unit "+e.currency)}e.distance_miles=e.distance*a,e.total_usd=e.total*n,e.usd_per_mile=e.total_usd/e.distance_miles}function u(e){var t=Object.assign({},r);t.taxi="Lyft";try{try{var a=/(\d{4}-\d{1,2}-\d{1,2}) ([A-z]*) ((?:\d*[.])?\d+) Taxi/,n=a.exec(e);t.date=n[1],t.currency=n[2],t.total=parseFloat(n[3]),n[3].includes(".")||(t.total/=100)}catch(u){try{var i=/(\w+\s+\d{1,2},\s+\d{4})/,s=i.exec(e);t.date=new Date(Date.parse(s[1])).toISOString().split("T")[0]}catch(d){}try{o=/([A-z]*\W*[A-z]*)((?:\d*[.])?\d+)\W+Pickup/,c=o.exec(e),t.currency=c[1],t.total=parseFloat(c[2])}catch(p){o=/(?:Sub)?[T|t]otal(?: Fare| charged .+:)?\s*([A-z]*\W*[A-z]*)((?:\d*[.])?\d+)/,c=o.exec(e),t.total=parseFloat(c[2]),t.currency=c[1]}}var o=/((?:\d*[.])?\d+)\s?(mi|km)\W+(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?/,c=o.exec(e);t.distance=parseFloat(c[1]),t.distance_units=c[2];var l=0;c[3]&&(l+=60*parseFloat(c[3])),c[4]&&(l+=parseFloat(c[4])),c[5]&&(l+=parseFloat(c[5])/60),t.time_minutes=l}catch(f){e.includes("Lyft Line Discount")?(t.distance_units="mi",t.time_minutes=t.distance=NaN):console.warn("failed parsing a Lyft message!",e,f)}return t}function d(e){var t=Object.assign({},r);t.taxi="Uber";try{var a=/(\d+-\d+-\d+) ([A-z]*) ((?:\d*[.])?\d+) Taxi/,n=a.exec(e);t.date=n[1],t.currency=n[2],t.total=parseFloat(n[3])}catch(l){try{var i=/(?:Sub)?[T|t]otal(?: Fare| charged .+:)?\s*([A-z]*\W*[A-z]*)((?:\d*[.])?\d+)/,s=i.exec(e);t.total=parseFloat(s[2]),t.currency=s[1];try{i=/Distance[\W]+((?:\d*[.])?\d+)[\s]+([A-z]+)\n/,s=i.exec(e),t.distance=parseFloat(s[1]),t.distance_units=s[2],i=/Duration[\W]+(?:(\d+)[\s]hours)?(?:[\W]+)?(?:(\d+)[\s]minutes)?(?:[\W]+)?(?:(\d+)[\s]seconds)?/,s=i.exec(e);var o=0;s[1]&&(o+=60*parseFloat(s[1])),s[2]&&(o+=parseFloat(s[2])),s[3]&&(o+=parseFloat(s[3])/60),t.time_minutes=o}catch(u){try{i=/((?:\d*[.])?\d+)\s+([A-z]+)\s?[\||&]\s?(?:(\d+)\s+h)?\s?(?:(\d+)\s+min)?\s?(?:(\d+)\s+s)?/,s=i.exec(e),t.distance=parseFloat(s[1]),t.distance_units=s[2],t.time_minutes=s[3]}catch(d){i=/((?:\d*[.])?\d+)\W+(kilometers|miles)\W+(\d+:\d+:\d+)/,s=i.exec(e),t.distance=parseFloat(s[1]),t.distance_units=s[2];var c=0;s[3]&&(c+=60*parseFloat(s[3])),s[4]&&(c+=parseFloat(s[4])),s[5]&&(c+=parseFloat(s[5])/60),t.time_minutes=c}}try{i=/Trip Request Date[\W]+(\w+\s+\d{1,2},\s+\d{4})/,s=i.exec(e),t.date=new Date(Date.parse(s[1])).toISOString().split("T")[0]}catch(p){try{i=/(\w+\s+\d{1,2},\s+\d{4})/,s=i.exec(e),t.date=new Date(Date.parse(s[1])).toISOString().split("T")[0]}catch(f){}}}catch(h){e.includes("trip is canceled")||e.includes("Previous Charge")||console.warn("failed parsing this Uber message!",e,h)}}return t}function p(e,t){for(var a=function(a){var n=e[a],i=new Date(Date.parse(n.date.getFullYear()+"-"+(n.date.getMonth()+1)+"-15"));i=i.getTime(),[n.taxi,"Uber+Lyft"].forEach(function(e){e in t||(t[e]={}),i in t[e]?["distance_miles","total_usd","usd_per_mile"].forEach(function(a){t[e][i][a].push(n[a])}):t[e][i]={distance_miles:[n.distance_miles],total_usd:[n.total_usd],usd_per_mile:[n.usd_per_mile]}})},i=0;i<e.length;++i)a(i);["Uber","Lyft","Uber+Lyft"].forEach(function(e){if(t[e]){var a=function(a){["distance_miles","total_usd","usd_per_mile"].forEach(function(i){t[e][a][i+"_mu"]=n.mean(t[e][a][i]),t[e][a][i+"_sigma"]=n.stdev(t[e][a][i]),t[e][a][i+"_mu_sigma"]=t[e][a][i+"_sigma"]/t[e][a][i].length})};for(var i in t[e])a(i)}})}}).call(this,a("c8ba"))},"84f27":function(e,t,a){},"89b1":function(e,t,a){"use strict";var n=a("84f27"),i=a.n(n);i.a}});
//# sourceMappingURL=app.521f9b1b.js.map